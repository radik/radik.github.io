Title: Dagger: Dependency Injection Framework для Android
Date: 2013-02-18 00:15:59
Author: Radik Fattakhov
Category: Blog
Tags: java, dependency injection, dagger, spring, google guice, square, IoC, infoq
Slug: 2013-02-18-dagger-dependency-injection-framework-android

**Disclaimer**: Это перевод [статьи с InfoQ](http://www.infoq.com/news/2012/10/dagger). Перевод сделан исключительно из эгоистических соображений для повышения собственного уровня грамотности. Мое мнение не обязательно совпадает с мнением автора.

[Square](https://squareup.com/) -  компания, специализирующаяся на мобильных платежах, недавно представила новую библиотеку [Dagger](http://www.slideshare.net/burkeeric/android-app-anatomy), описываемую как "A fast dependency injector for Android and Java". Код доступен на [GitHub](https://github.com/square/dagger).

Dependency injection (известный также как  [Inversion of Control](http://martinfowler.com/articles/injection.html)) уже вовсю используется в таких популярных фреймворках как [Spring](http://www.infoq.com/spring) и [Google Guice](http://www.infoq.com/guice). Однако они создавались с прицелом на стандартную JVM без учета особенностей мобильных платформ, таких как Android. В то время как [RoboGuice](http://code.google.com/p/roboguice/) является попыткой перенести опыт Guice на Android, Dagger использует другой подход и фокусируется на упрощении возможностей для улучшения производительности.

В настоящее время Dagger поддерживает:

-   Constructor injection при помощи стандартных аннотаций [JSR-330](http://www.jcp.org/en/jsr/detail?id=330)
-   Создание объектов при помощи аннотации @Provides
-   Центральный контекст для дерева зависимостей
-   Ленивые инъекции для дорогих ресурсов
-   Именование для различных реализаций одного интерфейса
-   Статическую инъекцию (для legacy кода)
-   Валидацию связей во время компиляции

<!-- more -->
На самом базовом уровне Dagger использует [аннотацию Inject](http://docs.oracle.com/javaee/6/api/javax/inject/Inject.html), которая так же поддерживается Spring и Guice. В Dagger поддерживается только инъекция через конструктор. Вы не можете использовать инъекцию через методы. Dagger также предоставляет аннотацию @Provides, которая работает аналогично одноименной аннотации в Guice.

После того как объявлены зависимости, установленные классы могут быть получены при помощи ObjectGraph, который хранит дерево всех объектов инициализированных при помощи Dagger. Граф работает аналогично ApplicationContext в Spring и Injector в Guice. Dagger так же разделяет концепцию модулей (Modules - коллекцию привязок), которую можно увидетьи в Guice.

Некоторые зависимости, такие как пул соединений, очень дороги, чтобы
создавать их заранее. Для таких ситуаций Dagger поддерживает ленивую
инициализацию. Опять синтаксис аналогичен Guice. Для случаев, когда
возможны несколько реализаций одного интерфейса, Dagger следует
соглашению аннотации @Named.

Наконец Dagger поддерживает инъекцию унаследованного кода, который
использует фабрики для внедрения зависимостей. И снова все это работает
аналогично синтаксису в Google Guice.

Пока кажется, что Dagger поддерживает лишь некоторое подмножество Google
Guice. Это логично, учитывая некоторое пересечение множеств людей,
разрабатываемых каждую из библиотек. Все же Dagger имеет более узкий
профиль и сделан с прицелом на Android. Наиболее поразительно полное
отсутствие возможности внедрение методов и полей.

Dagger жертвует этой возможностью, но улучшает обнаружение и проверку
ошибок. Обычно об ошибках внедрения зависимостей сообщается во время
выполнения приложения. Однако Dagger содержит валидацию аннотаций во
время компиляции, которая позволяет выявлять ошибки во время компиляции.
Это может облегчить разработку приложений для Android.

Другой большой отличительной чертой является отсутствие scoping, по
сравнению с другими популярными фреймворками. Dagger поддерживает лишь
аннотацию @Singleton и ничего больше. Это ожидаемо, так как разработка
под Android имеет отличные от стандартной веб-разработки требования (где
имеются request и session scopes).

Стоит также заметить, что пользователи Spring не только заметили Dagger,
но и создали два issue reports о недостатках Spring по сравнению с
Dagger. Первый о том факте, что [Spring внедряет лишь те классы, которые сами аннотированы](https://jira.springsource.org/browse/SPR-9835), и второй о неспособности Spring [различать классы, которые реализуют интерфейс с обобщениями](https://jira.springsource.org/browse/SPR-9836).

Автор - **[Kostis Kapelonis](http://www.infoq.com/author/Kostis-Kapelonis) **Software Engineer specializing in Enterprise applications

